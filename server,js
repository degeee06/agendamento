import express from 'express';
import bodyParser from 'body-parser';
import { GoogleSpreadsheet } from 'google-spreadsheet';

const app = express();
app.use(bodyParser.json());

const doc = new GoogleSpreadsheet('ID_DA_PLANILHA');
await doc.useServiceAccountAuth(require('./credentials.json'));
await doc.loadInfo();

const sheet = doc.sheetsByIndex[0];

app.post('/agendar', async (req, res) => {
  const { nome, email, data, hora } = req.body;
  const rows = await sheet.getRows();
  const ocupado = rows.find(r => r.data === data && r.hora === hora);
  if (ocupado) return res.json({ msg: 'Horário já reservado!' });

  await sheet.addRow({ nome, email, data, hora });
  res.json({ msg: 'Agendamento confirmado!' });
});

app.listen(3000, () => console.log('Servidor rodando'));
